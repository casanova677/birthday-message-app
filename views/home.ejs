<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Happy Birthday ðŸŽ‰</title>
  <script src="https://cdn.jsdelivr.net/npm/qrcode/build/qrcode.min.js"></script>
  <!-- Tailwind CDN -->
  <script src="https://cdn.tailwindcss.com"></script>
  <!-- Socket.io -->
  <script src="/socket.io/socket.io.js"></script>
  <link href="https://fonts.googleapis.com/css2?family=Cormorant+Garamond:wght@600;700&display=swap" rel="stylesheet">

   <link href="https://fonts.googleapis.com/css2?family=Dancing+Script&family=Great+Vibes&display=swap" rel="stylesheet">

  <style>
       /* Background container */
    .bg-slideshow {
      position: fixed;
      inset: 0;
      z-index: -15;
    }

      .fade-bottom {
        max-height: 100%;
        mask-image: linear-gradient(to bottom, black 85%, transparent);
        -webkit-mask-image: linear-gradient(to bottom, black 85%, transparent);
      }

      .auto-text {
        font-size: clamp(1.1rem, 2.2vw, 2.6rem);
        line-height: 1.4;
        word-break: break-word;
      }

    .bg-slide {
      position: absolute;
      inset: 0;
      background-size: cover;
      background-position: center 30%;
      opacity: 0;
      animation: fadeBg 16s infinite;
    }

    .bg-slide:nth-child(1) {
      background-image: url('/images/bg1.png') ;
      background-size: cover;
      min-height: 100vh; /* change */
      animation-delay: 0s;
    }

    .bg-slide:nth-child(2) {
      background-image: url('/images/bg2.jpg')  ;
      background-size: cover;
      min-height: 100vh;
      animation-delay: 8s;
    }

    @keyframes fadeBg {
      0% { opacity: 0; }
      15% { opacity: 1; }
      50% { opacity: 1; }
      65% { opacity: 0; }
      100% { opacity: 0; }
    }

    /* Optional soft overlay */
    .bg-overlay {
      position: fixed;
      inset: 0;
      background: linear-gradient(
        rgba(0,0,0,0.25),
        rgba(0,0,0,0.25)
      );
      z-index: -5;
    }
    .message-card {
    animation: floatIn 0.8s ease forwards;
  }

    @keyframes floatIn {
      from {
        transform: translateY(30px) scale(0.96);
        opacity: 0;
      }
      to {
        transform: translateY(0) scale(1);
        opacity: 1;
      }
    }
    @media (max-width: 640px) {
      .bg-slide {
        background-position: center 45%;
      }
    }
    /* Extra mobile safety */
    @media (max-width: 640px) {
      .bg-img {
        opacity: 0.18;
      }
    }
  </style>
</head>

<body class="h-screen flex flex-col items-center px-2 py-2 text-white overflow-hidden">
  <!-- ðŸŒˆ Animated Background Images -->
  <div class="bg-slideshow">
    <div class="bg-slide"></div>
    <div class="bg-slide"></div>
  </div>
  <div class="bg-overlay"></div>

  <!-- ðŸŽ‰ HERO -->
<div class="relative z-20 flex-shrink-0">
    <div class="flex flex-col items-center text-center px-2 flex-shrink-0 mb-6">

      <h1
        class="text-5xl sm:text-5xl md:text-6xl
              text-pink-600 font-extrabold drop-shadow-lg"
        style="font-family: 'Great Vibes', cursive;"
      >
        Happy 70th Birthday!
      </h1>

      <p
        class="mt-2 text-3xl sm:text-3xl md:text-4xl
              font-extrabold text-pink-600 mb-3"
        style="font-family:'Playfair Display SC', serif;"
      >
        Mrs Chinweokwu Blessing NgoziðŸ’–
      </p>

      <p class="mt-2 text-lg sm:text-lg md:text-xl opacity-90 max-w-md mb-3">
        BLESSED BY GRACE THROUGH EVERY SEASON ðŸ’–
      </p>
    </div>
  </div>
<!-- ðŸ’Œ MESSAGES -->
  <div id="messages" class="relative w-full max-w-[95vw] mx-auto flex items-start justify-center gap-4 px-2">

     <% messages.forEach(msg => { %>
      <div class="bg-white/20 backdrop-blur-xl rounded-3xl p-6 shadow-xl flex flex-row items-start gap-4">
  <!-- Text column -->
  <div class="flex-1">
    <p class="text-xl text-white-900 font-bold mb-2"><%= msg.sender_name %></p>
    <p class="text-xl text-white-900 font-bold" style="font-family: 'Cormorant Garamond', serif;"><%= msg.message %></p>
    <p class="text-sm text-white-700 opacity-80 mt-1"><%= new Date(msg.createdAt).toLocaleString() %></p>
  </div>

  <% if (msg.picture) { %>
    <img src="<%= msg.picture %>" 
      alt="Birthday Memory"
      class="w-36 h-36 sm:w-28 sm:h-28 rounded-2xl object-cover shadow-lg cursor-pointer hover:scale-105 transition flex-shrink-0"
    />
  <% } %>
</div>
      
    <% }) %>

  </div>

  <!-- ðŸ–¼ï¸ IMAGE MODAL -->
  <div id="imgModal"
      class="fixed inset-0 bg-black/80 hidden items-center justify-center z-50">
    <img id="modalImg"
        class="max-w-[90%] max-h-[90%] rounded-2xl shadow-2xl">
  </div>

<a href="/submit"
       class="inline-block mt-6 px-8 py-3 bg-white text-pink-600 font-semibold rounded-full shadow-lg hover:scale-105 transition">
      âž• Add Your Message
    </a>

<!-- ðŸ“± QR Code: Submit Message -->
<div
  class="fixed bottom-4 right-4 z-40 hidden sm:flex flex-col items-center gap-2
         bg-white/30 backdrop-blur-lg rounded-xl p-3 shadow-xl border border-white/40">

  <div id="qrCode"></div>

  <p class="text-xs text-white-700 text-center leading-tight">
    Scan to send<br>
    your birthday wishes ðŸŽ‰
  </p>
</div>
<!-- âš¡ SCRIPTS -->
<script>
  const socket = io();
  const messagesDiv = document.getElementById('messages');
  let allMessages = Array.from(messagesDiv.children);

  const BATCH_SIZE = 1;
  const INTERVAL = 15000;
  let index = 0;

  function showBatch() {
    messagesDiv.innerHTML = '';
    const batch = allMessages.slice(index, index + BATCH_SIZE);
    batch.forEach(el => messagesDiv.appendChild(el));
    index += BATCH_SIZE;
    if (index >= allMessages.length) index = 0;
  }

  showBatch();
  setInterval(showBatch, INTERVAL);

  socket.on('newMessage', msg => {
    const card = document.createElement('div');
    card.className =
      "fade-up bg-white/20 backdrop-blur-md rounded-2xl p-6 shadow-xl border border-white/30";

    card.innerHTML = `
      <div class="grid grid-cols-[1fr_auto] gap-6 items-start">
        <p class="text-lg font-medium text-gray-800">${msg.message}</p>
        ${msg.picture ? `<img src="${msg.picture}" data-enlarge class="w-28 h-28 object-cover rounded-xl shadow-md cursor-pointer" />` : ``}
      </div>
      <div class="mt-4 text-sm text-gray-600 opacity-80 text-right">
        ${new Date(msg.createdAt).toLocaleString()}
      </div>
    `;

    

    async function refreshMessages() {
        const res = await fetch('/messages/latest');
        const data = await res.json();

        allMessages = data.map(msg => {
          const card = document.createElement('div');
          card.className =
            "fade-up bg-white/20 backdrop-blur-md rounded-2xl p-6 shadow-xl border border-white/30";

          card.innerHTML = `
            <div class="grid grid-cols-[1fr_auto] gap-6 items-start">
              <p class="text-lg font-medium text-gray-800">${msg.message}</p>
              ${msg.picture ? `<img src="${msg.picture}" data-enlarge class="w-28 h-28 object-cover rounded-xl shadow-md cursor-pointer" />` : ``}
            </div>
            <div class="mt-4 text-sm text-gray-600 opacity-80 text-right">
              ${new Date(msg.createdAt).toLocaleString()}
            </div>
          `;
          return card;
        });
        showBatch();
      }

      setInterval(refreshMessages, 15000);

      /* Image modal */
      card.querySelectorAll('img[data-enlarge]').forEach(img => {
        img.addEventListener('click', () => {
          document.getElementById('modalImg').src = img.src;
          document.getElementById('imgModal').classList.remove('hidden');
          document.getElementById('imgModal').classList.add('flex');
        });
      });
  });

    

  /* Image modal */
  document.addEventListener('click', e => {
    if (e.target.dataset.enlarge) {
      modalImg.src = e.target.src;
      imgModal.classList.remove('hidden');
      imgModal.classList.add('flex');
    }
  });
  imgModal.addEventListener('click', () => {
    imgModal.classList.add('hidden');
  });

  /* Confetti */
  setTimeout(() => {
    for (let i = 0; i < 80; i++) {
      const c = document.createElement('div');
      c.style.position = 'fixed';
      c.style.top = '-10px';
      c.style.left = Math.random() * 100 + 'vw';
      c.style.width = '8px';
      c.style.height = '8px';
      c.style.background = `hsl(${Math.random()*360},100%,70%)`;
      c.style.borderRadius = '50%';
      c.style.animation = `fall ${3 + Math.random()*2}s linear`;
      document.body.appendChild(c);
      setTimeout(() => c.remove(), 5000);
    }
  }, 800);
</script>
<script>
  document.querySelectorAll('.auto-text').forEach(p => {
    if (p.scrollHeight > p.clientHeight + 20) {
      p.insertAdjacentHTML(
        'afterend',
        `<div class="text-sm text-black/70 mt-2 italic">â€” Message continues â€”</div>`
      );
    }
  });
</script>
<script>
  const submitUrl = `${window.location.origin}/submit`;

  QRCode.toCanvas(
    document.createElement('canvas'),
    submitUrl,
    { width: 120, margin: 1 },
    function (err, canvas) {
      if (err) console.error(err);
      document.getElementById('qrCode').appendChild(canvas);
    }
  );
</script>


</body>
</html>